name: score
run-name: score the code
on: [push]

jobs:
  score:
    runs-on: ghci
    steps:
    - name: Checkout
      uses: https://gitea.com/actions/checkout@v4
    - name: Score
      run: |
        make score > log
        echo "Your score is $(cat log | grep -Po "(?<=^upload score: )[0-9]+\.[0-9]+\$"
        curl --location 'https://gh-leaderboard.thudep.com/' \
        --header 'Content-Type: application/json' \
        --data "{\"team\": \"$(echo \${{ gitea.repository }} | sed "s/\/.*//g")\",\"score\": $(cat log | grep -Po "(?<=^upload score: )[0-9]+\.[0-9]+\$"),\"time\": \"$(date --rfc-3339=seconds)\",\"secret\":\"${{ secrets.GHOST_HUNTER_LEADERBOARD_TOKEN }}\"}" && echo "Score uploaded successfully!"
